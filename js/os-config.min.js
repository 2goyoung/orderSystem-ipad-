var iscroll=iscroll===undefined?{}:iscroll,$body=$("body"),$ajaxPage=$("#page"),$page=$(".os-page"),panel={},$loading=$(".os-loading-bar"),loadingTimer={},sortData={status:"all",contain:"all"},$preferences={duration:800,easing:"easeInOutQuad",adjustHeight:!1,useScaling:!0},ospage=new cxuiPage($("#os-page"),{animate:!0}),showHtml;document.addEventListener("touchmove",function(n){n.preventDefault()},!1);$("select,input[text],input[radio],textarea").livequery("touchstart mousedown",function(n){n.stopPropagation()});window.orderSystem={Model:{},View:{},Collection:{},datas:{detialIndex:"",dinCatData:"",teaList:"",order:{id:"",dinNum:"",perNum:0,dinCode:"",dinList:{},teaList:{},inOrder:{},info:{}},dinListLoaded:{},dinCatId:"",dinCatIndex:0},orderPanel:{},loaded:!1,urlRouter:{page:{login:"./ajax-login.html",channel:"./ajax-channel.html",guide:"./ajax-guide.html",menu:"./ajax-menu.html"},data:{login:"./data/login.txt",logout:"./data/logout.txt",teaList:"./data/tea-list.txt",areaCode:"./data/area-code.txt",tableList:"./data/table-list.txt",createOrder:"./data/create-order.txt",getOrder:"./data/order.txt",saveDish:"./data/save-dish.txt",cancelDish:"./data/cancel-dish.txt",dinCat:"./data/din-cat.txt",dinList:"./data/din-list.txt",orderId:"./data/order-id.txt",orderInfo:"./data/order-info.txt"},theme:{"default":"./theme/default/css/os-default.css"}},pages:{login:function(){ospage.openPage({pageId:"os-login",pageUrl:orderSystem.urlRouter.page.login,loadingText:"页面加载中...",pageTitle:"点餐系统-登录",animateClass:"pop in",loaded:!0,callback:function(){window.login=new orderSystem.View.login}})},channel:function(){ospage.openPage({pageId:"channel",pageUrl:orderSystem.urlRouter.page.channel,pageTitle:"点餐系统-选台页",loadingText:"登录中...",animateClass:"pop in",loaded:!0,ajaxCallback:function(){},callback:function(){iscroll.tableList=[];$(".table-content").eq(0).addClass("active");$(".c-banner,.c-content").bind("tap",function(){$(".opening").removeClass("opening");$(".c-panel").removeClass("in")});orderSystem.logout===undefined&&(orderSystem.logout=new orderSystem.View.logout);var n=new orderSystem.View.areaCode;orderSystem.getTeaList(function(){orderSystem.teaList=new orderSystem.View.teaList({collection:orderSystem.datas.teaList});orderSystem.teaList.render();iscroll.teasList=new iScroll("teas-list")});orderSystem.orderPanel=new orderSystem.View.orderPanel}})},guide:function(){ospage.openPage({pageId:"guide",pageTitle:"",pageUrl:orderSystem.urlRouter.page.guide,loadingText:"资源加载中...",animateClass:"pop in",ajaxCallback:function(){},callback:function(){$("#guide .table-num").html(orderSystem.datas.order.dinCode);$("#guide .person-num").html(orderSystem.datas.order.perNum);var n=function(n,t){orderSystem.pages.article(n,t)};$(".guide-list a").on("touchstart mousedown",function(){return $(this).find("i").addClass("magnify"),$(this).attr({up:"false",animated:"false"}),!1});$(".guide-list a").on("touchend mouseup",function(){if($(this).attr("animated")=="true")if($(this).hasClass("menu"))orderSystem.pages.menu();else{var n=$(this).text(),t=$(this).attr("href");orderSystem.pages.article(n,t)}else $(this).attr({up:"true"});return!1});$(".guide-list a").on("click",function(){return!1});$(".guide-list a").on("webkitAnimationEnd",function(){if($(this).attr({animated:"true"}).find("i").removeClass("magnify"),$(this).attr("up")=="true")if($(this).hasClass("menu"))orderSystem.pages.menu();else{var n=$(this).text(),t=$(this).attr("href");orderSystem.pages.article(n,t)}})}})},article:function(n,t){ospage.changePage({pageId:"guide",animateClass:"turn out "},{pageId:"article",pageTitle:n,pageUrl:t,loadingText:"加载内容中...",animateClass:"fade in",loaded:!0,callback:function(){iscroll.article=new iScroll($(".article-main")[0])}},!1)},menu:function(n){var t=ospage.getCurrentId();ospage.changePage({pageId:t,animateClass:"turn out "},{pageId:"menu",pageTitle:"菜谱",pageUrl:orderSystem.urlRouter.page.menu,loadingText:"加载菜谱中...",animateClass:"fade in",loaded:!0,ajaxCallback:function(){},callback:function(){var u,f,e,o,t,i,r;if(n!==undefined&&n(),u=orderSystem.datas.order.dinList.calculate(),f=parsePrice(u.totalPrice),$("#din-count").html(u.totalNum),$("#din-price").html(f),orderSystem.getOrderInfo(function(){orderSystem.datas.order.dinCode=orderSystem.datas.order.info.ordInfo.dinCodes;$("#menu .table-num").html(orderSystem.datas.order.dinCode);orderSystem.datas.order.perNum=="0"&&(orderSystem.datas.order.perNum=orderSystem.datas.order.info.ordInfo.cusNum);$("#menu .person-num").html(orderSystem.datas.order.perNum);$("#menu .order-time").html(orderSystem.datas.order.info.ordInfo.ordStartTime)}),e="ontouchstart"in window,orderSystem.datas.haSwipe=!1,iscroll.menu=[],iscroll.menu[1]=new iScroll($(".food-list-wrap")[0]),$(".menu-nav-list li").length==0?orderSystem.datas.dinCat?(o=new orderSystem.View.dinCat({collection:orderSystem.datas.dinCat}),o.render(),$("#"+orderSystem.datas.dinCatId).trigger("tap"),orderSystem.datas.dinCatId="",iscroll.menu[0]=new iScroll($(".os-menu-nav .wrap")[0])):orderSystem.getDinCat(function(){var n=new orderSystem.View.dinCat({collection:orderSystem.datas.dinCat});n.render();$("#"+orderSystem.datas.dinCatId).trigger("tap");orderSystem.datas.dinCatId="";iscroll.menu[0]=new iScroll($(".os-menu-nav .wrap")[0])}):($("#"+orderSystem.datas.dinCatId).trigger("tap"),orderSystem.datas.dinCatId=""),$(".din-item-detail .btn-close").livequery("tap",function(){$(".din-item-detail").removeClass("pop in ").addClass("pop out").one("webkitAnimationEnd",function(){$(this).find(".wrap").html("").removeAttr("style")})}),t=0,e)$(".din-item-detail .wrap").on("touchstart",function(n){orderSystem.datas.haSwipe=!1;t=n.touches[0].pageX;$(this).css("-webkit-transform","translate3d(0px, 0, 0)");i=$(".din-item-detail .item-detail").eq(0).height();r=$(".din-item-detail .item-detail").eq(0).width()}).on("touchmove",function(n){var u=n.touches[0].pageX-t,f;$(this).css("-webkit-transform","translate3d("+u+"px, 0, 0)");f=parseInt(Math.abs(u)/r*i)}).on("touchend",function(){setTimeout(function(){orderSystem.datas.haSwipe||$(".din-item-detail .wrap").addClass("animate").css("-webkit-transform","translate3d(0, 0, 0)")},100)});else $(".din-item-detail .wrap").on("mousedown",function(n){t=n.pageX;orderSystem.datas.haSwipe=!1;i=$(".din-item-detail .item-detail").eq(0).height();r=$(".din-item-detail .item-detail").eq(0).width();console.log(i,r);$(this).on("mousemove",function(n){var u=n.pageX-t,f;$(this).css("-webkit-transform","translate3d("+u+"px, 0, 0)");f=parseInt(Math.abs(u)/r*i);$(this).find(".item-detail").eq(0).css("-webkit-transform","translate3d(0,"+f+"px, 0)")})}).on("mouseup",function(){$(this).off("mousemove");setTimeout(function(){orderSystem.datas.haSwipe||$(".din-item-detail .wrap").addClass("animate").css("-webkit-transform","translate3d(0, 0, 0)")},300)});$(".din-item-detail .wrap").on("webkitTransitionEnd",function(){$(this).removeClass("animate").css({"-webkit-transform":"translate3d(0, 0, 0)"})});$(".din-item-detail .item-detail").livequery("webkitTransitionEnd",function(){$(this).removeClass("animate")})}},!1)},order:function(n){var t=ospage.getCurrentId();ospage.changePage({pageId:t,animateClass:"flip out reverse"},{pageId:"order",pageTitle:"订单",loadingText:"加载订单中...",pageUrl:"ajax-order.html",animateClass:"flip in reverse",loaded:!0,callback:function(){n!==undefined&&n();$("#order .table-num").html(orderSystem.datas.order.dinCode);orderSystem.getOrderInfo(function(){orderSystem.datas.order.perNum=="0"&&(orderSystem.datas.order.perNum=orderSystem.datas.order.info.ordInfo.cusNum);$("#order .person-num").html(orderSystem.datas.order.perNum);$("#order .order-time").html(orderSystem.datas.order.info.ordInfo.ordStartTime)});$(".call-service").on("tap",function(n){n.stopPropagation();orderSystem.alert("暂不支持此功能")});iscroll.orderList=[];var r={init:function(n,t){var i=this;this.$silder=n;this.getHeight();this.showList(t);$.each(this.$silder.find(".order-list-wrap"),function(n,t){iscroll.orderList[n]=new iScroll(t)});n.on("tap","dt",function(){if($(this).parent().hasClass("active"))return!1;var n=$(this).parent().index();i.showList(n)});$(window).resize(function(){i.getHeight();var n=i.$silder.find(".active").index();i.setTitlePosition(n)})},showList:function(n){this.$silder.find(".t").removeClass("t");this.$silder.find("dd").css("opacity",0);this.$silder.find("li").removeAttr("style");this.$silder.find(".active").removeClass("active");this.setTitlePosition(n);this.$silder.find("dl").eq(n).addClass("active").find("dd").animate({opacity:"1"},{complete:function(){var n=$(this).find("li");$.each(n,function(n){var t=.1*n;$(this).attr("style","-webkit-transition-delay:"+t+"s;opacity:1;").addClass("t")})}})},setTitlePosition:function(n){var t=this.$silder.find("dl"),i=this;$.each(t,function(t){t<=n?$(this).css({"-webkit-transform":"translate(0,0)"}):$(this).css({"-webkit-transform":"translate(0,"+i.contentHeight+"px)"})})},getHeight:function(){this.height=this.$silder.height();this.num=this.$silder.find("dl").length;this.titleHeight=this.$silder.find("dt").height();this.contentHeight=this.height-this.titleHeight*this.num;this.sliderHeight=this.contentHeight-this.titleHeight;this.$silder.find("dd").height(this.contentHeight)}},i={};t=="menu"?($(".os-order-content dl").length<=1&&(i=new orderSystem.View.orderCatList({collection:orderSystem.datas.dinCat}),i.render()),r.init($(".os-order-content"),0)):orderSystem.mergeOrder(function(){orderSystem.getDinCat(function(){i=new orderSystem.View.orderCatList({collection:orderSystem.datas.dinCat});i.render();r.init($(".os-order-content"),0)})});new orderSystem.View.orderSubmit}},!0)},back:function(){ospage.backPage("slide out reverse","slide in reverse",!0)}},initialize:function(){var n=this;n.loaded?(n.pages.login(),n.datas.dinListLoaded=new orderSystem.Collection.dinListLoaded,n.datas.order.teaList=new orderSystem.Collection.teaOrder,n.datas.order.dinList=new orderSystem.Collection.dinOrder):window.onload=function(){n.pages.login();n.datas.dinListLoaded=new orderSystem.Collection.dinListLoaded;n.datas.order.teaList=new orderSystem.Collection.teaOrder;n.datas.order.dinList=new orderSystem.Collection.dinOrder};$(".top-order-info").livequery("tap",function(){orderSystem.pages.order()})},getTeaList:function(n){this.datas.teaList=new orderSystem.Collection.teaList;this.datas.teaList.deferred.done(function(){n!==undefined&&n()})},getDinCat:function(n){this.datas.dinCat=new orderSystem.Collection.dinCatList;this.datas.dinCat.deferred.done(function(){n!==undefined&&n()})},getOrderId:function(n){$.getJSON(this.urlRouter.data.orderId,{_seq_dinCode:this.datas.order.dinCode},function(t){return t.state==0?(orderSystem.alert(t.message),!1):(orderSystem.datas.order.id=t.ordId,n!==undefined&&n(),t.ordId)})},getOrderData:function(n){var t=this;this.datas.order.id==""?this.getOrderId(function(){t.datas.order.inOrder=new orderSystem.Collection.order;t.datas.order.inOrder.deferred.done(function(){n!==undefined&&n()})}):(t.datas.order.inOrder=new orderSystem.Collection.order,t.datas.order.inOrder.deferred.done(function(){n!==undefined&&n()}))},getOrderInfo:function(n){var i=this,t;i.datas.order.info.length?n!==undefined&&n():(t=new orderSystem.Collection.orderInfo,t.deferred.done(function(){i.datas.order.info=t.models[0].attributes;n!==undefined&&n()}))},mergeOrder:function(n){var t=this;t.datas.order.inOrder.length?(_.each(t.datas.order.inOrder.models[0].attributes.ordDishInfo,function(n){var i=t.datas.order.dinList.findWhere({dishId:n.dishId});typeof i=="undefined"?n.typeName=="茶位"?t.datas.order.teaList.add(new orderSystem.Model.empty(n)):(n.ordNum=0,t.datas.order.dinList.add(new orderSystem.Model.empty(n))):i.set({total:parseInt(i.attributes.total)+parseInt(n.total)})}),n!==undefined&&n()):this.getOrderData(function(){_.each(t.datas.order.inOrder.models[0].attributes.ordDishInfo,function(n){var i=t.datas.order.dinList.findWhere({dishId:n.dishId});typeof i=="undefined"?n.typeName=="茶位"?t.datas.order.teaList.add(new orderSystem.Model.empty(n)):(n.ordNum=0,t.datas.order.dinList.add(new orderSystem.Model.empty(n))):i.set({total:parseInt(i.attributes.total)+parseInt(n.total)})});n!==undefined&&n()})}};window.onload=function(){orderSystem.loaded=!0;setTimeout(scrollTo,0,0,0)};navigator.onLine?(window.applicationCache.status==window.applicationCache.UPDATEREADY,ospage.setLoadingText("系统初始化中...").show(),ospage.testXHR("./images/test.png",function(n){n.status=="200"?window.orderSystem.initialize():(ospage.loading.hide(),orderSystem.alert("网络请求异常,请刷新系统重试",{btnText:"刷新",callback:function(){window.location.reload()}}))})):(showHtml='<div class="os-top"><img class="logo" src="theme/default/images/logo.png"/><\/div><div class="os-login"><form id="login"><div class="login"><div class="t"><\/div><div class="m"><div class="u-name"><label>用户名<\/label><input id="u-name" type="text" /><\/div><div class="u-pw"><label>密码<\/label><input id="u-pw" type="password"/><\/div><\/div><div class="b"><input type="reset" value="重置"/><input type="submit" value="确定"/><\/div><\/div><\/form><\/div>',$("#os-page").append($(showHtml)),orderSystem.alert("你当前处于离线状态，系统不可用"));
//# sourceMappingURL=os-config.min.js.map